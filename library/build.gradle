apply plugin: 'android-library'
apply plugin: 'maven-publish'

android {
    compileSdkVersion 'android-L'
    buildToolsVersion "20.0.0"

    publishNonDefault true

    defaultPublishConfig "release"

    defaultConfig {
        minSdkVersion 7
        targetSdkVersion 20
        versionCode 1
        versionName "1.0"
    }

    lintOptions {
        abortOnError false
    }

    buildTypes {
        release {
            runProguard false
            proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'
        }
    }
}

repositories {
    maven { url "http://files.couchbase.com/maven2/" }
    mavenLocal()
    mavenCentral()
}

dependencies {
    compile files('libs/couchbase-android-1.0.0-54.jar', 'libs/java-json.jar')
    compile 'com.couchbase.lite:couchbase-lite-android:+'
    compile 'com.google.code.gson:gson:+'
    compile 'com.loopj.android:android-async-http:+'
}

android.libraryVariants

task androidReleaseJar(type: Jar, dependsOn: assembleRelease) {

    depClasses = configurations.compile.collect { it.isDirectory() ? it : zipTree(it) }
    depClasses.add("$buildDir/intermediates/classes/release")

    from({ depClasses }) {
        exclude 'META-INF/MANIFEST.MF'
        exclude '**AndroidManifest.xml'
        exclude '**/res/**'
        exclude "**/classes.jar"
    }
}

publishing {
    publications {
        maven(MavenPublication) {
            groupId 'com.znck.android'
            artifactId 'android-sync-nosql'
            version '1.0.1-1'

            artifact androidReleaseJar
        }
    }
    repositories {
        maven {
            url "$buildDir/../../releases/"
        }
    }
}